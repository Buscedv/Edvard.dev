# updates & installs
apt-get update
apt-get upgrade
apt-get autoremove
apt-get install nginx

# user setup
adduser git
usermod -aG sudo git
rsync --archive --chown=git:git ~/.ssh /home/git
su git
cd
whoami
pwd
sudo mkdir -p /var/lib/gitea/{custom,data,indexers,public,log}
sudo chown git:git /var/lib/gitea/{data,indexers,log}
sudo chmod 750 /var/lib/gitea/{data,indexers,log}
sudo mkdir /etc/gitea
sudo chown root:git /etc/gitea
sudo chmod 770 /etc/gitea

# Nginx
sudo service nginx enable
sudo service nginx start
sudo service nginx status
sudo rm /etc/nginx/sites-enabled/default

# Gitea installation
sudo wget -O gitea https://dl.gitea.io/gitea/1.8.3/gitea-1.8.3-linux-amd64 
sudo chmod +x gitea
sudo cp gitea /usr/local/bin/gitea
sudo gitea web

# ssl
sudo apt install certbot python-certbot-nginx
sudo service nginx stop
sudo certbot certonly --standalone -d buscedv-git.com
sudo service nginx start
sudo nano /etc/nginx/sites-available/git
sudo ln -s /etc/nginx/sites-available/git /etc/nginx/sites-enabled
sudo service nginx restart

# start gitea
sudo gitea web

# done
echo "DONE"
